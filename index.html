<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8"/>
  <title>Debug HeyGen Embed</title>
  <style>
    html, body { margin:0; padding:0; width:100%; height:100%; overflow:hidden; }
    #myChatBtn {
      position: fixed;
      top:50%; left:50%;
      transform:translate(-50%,-50%);
      padding:12px 24px; background:#ff3366; color:#fff;
      border:none; border-radius:24px; cursor:pointer;
      z-index:10001;
    }
  </style>
</head>
<body>

  <button id="myChatBtn">Chat Now</button>

  <script>
    (function(){
      console.log("Script di debug caricato");
      const host = "https://labs.heygen.com";
      const embedUrl = "https://labs.heygen.com/guest/streaming-embed?share=â€¦&inIFrame=1";

      let container, loaded=false;

      function createEmbed(){
        console.log("Creo l'embed HeyGen");
        container = document.createElement("div");
        Object.assign(container.style,{
          position:"fixed", top:"0", left:"0", right:"0", bottom:"0",
          display:"none", zIndex:"9999", overflow:"hidden"
        });
        const iframe = document.createElement("iframe");
        iframe.src = embedUrl;
        iframe.allow = "microphone";
        iframe.allowFullscreen = true;
        Object.assign(iframe.style,{border:"none", width:"100%", height:"100%"});
        container.appendChild(iframe);
        document.body.appendChild(container);

        window.addEventListener("message", e=>{
          if(e.origin===host && e.data?.type==="streaming-embed" && e.data.action==="hide"){
            console.log("HeyGen ha chiuso l'embed");
            container.style.display="none";
          }
        });

        loaded = true;
      }

      const btn = document.getElementById("myChatBtn");
      btn.addEventListener("click", ()=>{
        console.log("Hai cliccato Chat Now");
        if(!loaded) createEmbed();
        container.style.display = "block";
      });
    })();
  </script>

</body>
</html>
